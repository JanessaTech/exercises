const {ethers} = require('ethers')

function getWallet() {
    // 利用公共rpc节点连接以太坊网络
    // 可以在 https://chainlist.org 上找到
    //const SEPOLIA_URL = 'https://rpc.sepolia.org';
    //const providerSepolia = new ethers.JsonRpcProvider(SEPOLIA_URL)
    const provider = new ethers.JsonRpcProvider('http://127.0.0.1:8545/')  // make sure local hardhat is started
    const privateKey = '0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80'
    const wallet = new ethers.Wallet(privateKey, provider)
    return wallet
}

async function deploy() {
    const abi = [
        'function setMsg(string _mesg) public',
        'function getMsg() public view returns(string)',
        'event logger(address indexed from, string indexed method, string mesg)',
        'function deposit() public payable'
    ]
    const wallet = getWallet()
    /**
     * input byteCode which you could get in 2 ways:
     * 1. In remix, click Bytecode button on compiling console
     * 2. In HelloWorld.json under artifact, get it in "object:" field under "data"."bytecode" which looks like
     * "object": "60806040526040518060400160405... 
     */
    const byteCode ='60806040526040518060400160405280600f81526020017f64656661756c74206d65737361676500000000000000000000000000000000008152505f9081620000499190620002c5565b505f6001553480156200005a575f80fd5b50620003a9565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680620000dd57607f821691505b602082108103620000f357620000f262000098565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f60088302620001577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826200011a565b6200016386836200011a565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f620001ad620001a7620001a1846200017b565b62000184565b6200017b565b9050919050565b5f819050919050565b620001c8836200018d565b620001e0620001d782620001b4565b84845462000126565b825550505050565b5f90565b620001f6620001e8565b62000203818484620001bd565b505050565b5b818110156200022a576200021e5f82620001ec565b60018101905062000209565b5050565b601f82111562000279576200024381620000f9565b6200024e846200010b565b810160208510156200025e578190505b620002766200026d856200010b565b83018262000208565b50505b505050565b5f82821c905092915050565b5f6200029b5f19846008026200027e565b1980831691505092915050565b5f620002b583836200028a565b9150826002028217905092915050565b620002d08262000061565b67ffffffffffffffff811115620002ec57620002eb6200006b565b5b620002f88254620000c5565b620003058282856200022e565b5f60209050601f8311600181146200033b575f841562000326578287015190505b620003328582620002a8565b865550620003a1565b601f1984166200034b86620000f9565b5f5b8281101562000374578489015182556001820191506020850194506020810190506200034d565b8683101562000394578489015162000390601f8916826200028a565b8355505b6001600288020188555050505b505050505050565b610a6280620003b75f395ff3fe608060405260043610610037575f3560e01c8063b5fdeb2314610130578063c4784fd41461015a578063d0e30db014610182576100b6565b366100b6573460015f82825461004d919061033f565b92505081905550604051610060906103c6565b60405180910390203373ffffffffffffffffffffffffffffffffffffffff167ff82613928f170aecc20aca5c4f53d671aa8fc6877ab3921d5460f60ed923e7526040516100ac9061040d565b60405180910390a3005b3460015f8282546100c7919061033f565b925050819055506040516100da90610475565b60405180910390203373ffffffffffffffffffffffffffffffffffffffff167ff82613928f170aecc20aca5c4f53d671aa8fc6877ab3921d5460f60ed923e7526040516101269061040d565b60405180910390a3005b34801561013b575f80fd5b5061014461018c565b6040516101519190610503565b60405180910390f35b348015610165575f80fd5b50610180600480360381019061017b9190610660565b61021b565b005b61018a61028f565b005b60605f805461019a906106d4565b80601f01602080910402602001604051908101604052809291908181526020018280546101c6906106d4565b80156102115780601f106101e857610100808354040283529160200191610211565b820191905f5260205f20905b8154815290600101906020018083116101f457829003601f168201915b5050505050905090565b805f908161022991906108a1565b50604051610236906109ba565b60405180910390203373ffffffffffffffffffffffffffffffffffffffff167ff82613928f170aecc20aca5c4f53d671aa8fc6877ab3921d5460f60ed923e752836040516102849190610503565b60405180910390a350565b3460015f8282546102a0919061033f565b925050819055506040516102b390610a18565b60405180910390203373ffffffffffffffffffffffffffffffffffffffff167ff82613928f170aecc20aca5c4f53d671aa8fc6877ab3921d5460f60ed923e7526040516102ff9061040d565b60405180910390a3565b5f819050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61034982610309565b915061035483610309565b925082820190508082111561036c5761036b610312565b5b92915050565b5f81905092915050565b7f72656365697665000000000000000000000000000000000000000000000000005f82015250565b5f6103b0600783610372565b91506103bb8261037c565b600782019050919050565b5f6103d0826103a4565b9150819050919050565b5f82825260208201905092915050565b50565b5f6103f85f836103da565b9150610403826103ea565b5f82019050919050565b5f6020820190508181035f830152610424816103ed565b9050919050565b7f66616c6c6261636b0000000000000000000000000000000000000000000000005f82015250565b5f61045f600883610372565b915061046a8261042b565b600882019050919050565b5f61047f82610453565b9150819050919050565b5f81519050919050565b5f5b838110156104b0578082015181840152602081019050610495565b5f8484015250505050565b5f601f19601f8301169050919050565b5f6104d582610489565b6104df81856103da565b93506104ef818560208601610493565b6104f8816104bb565b840191505092915050565b5f6020820190508181035f83015261051b81846104cb565b905092915050565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b610572826104bb565b810181811067ffffffffffffffff821117156105915761059061053c565b5b80604052505050565b5f6105a3610523565b90506105af8282610569565b919050565b5f67ffffffffffffffff8211156105ce576105cd61053c565b5b6105d7826104bb565b9050602081019050919050565b828183375f83830152505050565b5f6106046105ff846105b4565b61059a565b9050828152602081018484840111156106205761061f610538565b5b61062b8482856105e4565b509392505050565b5f82601f83011261064757610646610534565b5b81356106578482602086016105f2565b91505092915050565b5f602082840312156106755761067461052c565b5b5f82013567ffffffffffffffff81111561069257610691610530565b5b61069e84828501610633565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f60028204905060018216806106eb57607f821691505b6020821081036106fe576106fd6106a7565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026107607fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610725565b61076a8683610725565b95508019841693508086168417925050509392505050565b5f819050919050565b5f6107a56107a061079b84610309565b610782565b610309565b9050919050565b5f819050919050565b6107be8361078b565b6107d26107ca826107ac565b848454610731565b825550505050565b5f90565b6107e66107da565b6107f18184846107b5565b505050565b5b81811015610814576108095f826107de565b6001810190506107f7565b5050565b601f8211156108595761082a81610704565b61083384610716565b81016020851015610842578190505b61085661084e85610716565b8301826107f6565b50505b505050565b5f82821c905092915050565b5f6108795f198460080261085e565b1980831691505092915050565b5f610891838361086a565b9150826002028217905092915050565b6108aa82610489565b67ffffffffffffffff8111156108c3576108c261053c565b5b6108cd82546106d4565b6108d8828285610818565b5f60209050601f831160018114610909575f84156108f7578287015190505b6109018582610886565b865550610968565b601f19841661091786610704565b5f5b8281101561093e57848901518255600182019150602085019450602081019050610919565b8683101561095b5784890151610957601f89168261086a565b8355505b6001600288020188555050505b505050505050565b7f7365744d736700000000000000000000000000000000000000000000000000005f82015250565b5f6109a4600683610372565b91506109af82610970565b600682019050919050565b5f6109c482610998565b9150819050919050565b7f6465706f736974000000000000000000000000000000000000000000000000005f82015250565b5f610a02600783610372565b9150610a0d826109ce565b600782019050919050565b5f610a22826109f6565b915081905091905056fea26469706673582212202f037634515d491229cfb4d58d1b475113b3b3e11b26979754422805a091ebe164736f6c63430008160033'
    const factory = new ethers.ContractFactory(abi, byteCode, wallet)
    const contractInstance = await factory.deploy()
    console.log('HelloWorld.sol is deployed at ', contractInstance.target)
    const tx = contractInstance.deploymentTransaction()  //This is only available if this instance was returned from a ContractFactory.
    console.log('transaction details used to deploy contract')
    console.log(tx)
    const deployedCode = await contractInstance.getDeployedCode()
    console.log('deployed code')
    console.log(deployedCode)
    console.log('HelloWorld.sol is deployed on hardhat')
}

deploy()

