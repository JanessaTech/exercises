const {ethers} = require('ethers')

function getWallet() {
    // 利用公共rpc节点连接以太坊网络
    // 可以在 https://chainlist.org 上找到
    //const SEPOLIA_URL = 'https://rpc.sepolia.org';
    //const providerSepolia = new ethers.JsonRpcProvider(SEPOLIA_URL)
    const provider = new ethers.JsonRpcProvider('http://127.0.0.1:8545/')
    const privateKey = '0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80'
    const wallet = new ethers.Wallet(privateKey, provider)
    return wallet
}

async function deploy() {
    const abi = [
        'function setMsg(string _mesg) public',
        'function getMsg() public view returns(string)',
        'event logger(address indexed from, string indexed method, string mesg)'
    ]
    const wallet = getWallet()
    /**
     * input byteCode which you could get in 2 ways:
     * 1. In remix, click Bytecode button on compiling console
     * 2. In HelloWorld.json under artifact, get it in "object: field under "data"."bytecode" which looks like
     * "object": "60806040526040518060400160405... 
     */
    const byteCode ='60806040526040518060400160405280600f81526020017f64656661756c74206d65737361676500000000000000000000000000000000008152505f9081620000499190620002c1565b5034801562000056575f80fd5b50620003a5565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680620000d957607f821691505b602082108103620000ef57620000ee62000094565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f60088302620001537fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8262000116565b6200015f868362000116565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f620001a9620001a36200019d8462000177565b62000180565b62000177565b9050919050565b5f819050919050565b620001c48362000189565b620001dc620001d382620001b0565b84845462000122565b825550505050565b5f90565b620001f2620001e4565b620001ff818484620001b9565b505050565b5b8181101562000226576200021a5f82620001e8565b60018101905062000205565b5050565b601f82111562000275576200023f81620000f5565b6200024a8462000107565b810160208510156200025a578190505b62000272620002698562000107565b83018262000204565b50505b505050565b5f82821c905092915050565b5f620002975f19846008026200027a565b1980831691505092915050565b5f620002b1838362000286565b9150826002028217905092915050565b620002cc826200005d565b67ffffffffffffffff811115620002e857620002e762000067565b5b620002f48254620000c1565b620003018282856200022a565b5f60209050601f83116001811462000337575f841562000322578287015190505b6200032e8582620002a4565b8655506200039d565b601f1984166200034786620000f5565b5f5b82811015620003705784890151825560018201915060208501945060208101905062000349565b868310156200039057848901516200038c601f89168262000286565b8355505b6001600288020188555050505b505050505050565b61069780620003b35f395ff3fe608060405234801561000f575f80fd5b5060043610610034575f3560e01c8063b5fdeb2314610038578063c4784fd414610056575b5f80fd5b610040610072565b60405161004d91906101eb565b60405180910390f35b610070600480360381019061006b9190610348565b610101565b005b60605f8054610080906103bc565b80601f01602080910402602001604051908101604052809291908181526020018280546100ac906103bc565b80156100f75780601f106100ce576101008083540402835291602001916100f7565b820191905f5260205f20905b8154815290600101906020018083116100da57829003601f168201915b5050505050905090565b805f908161010f9190610592565b503373ffffffffffffffffffffffffffffffffffffffff167f1817836ae3b5afe565ae5f9b40388de4ee15d41f925880d834a4d42e4eae5c678260405161015691906101eb565b60405180910390a250565b5f81519050919050565b5f82825260208201905092915050565b5f5b8381101561019857808201518184015260208101905061017d565b5f8484015250505050565b5f601f19601f8301169050919050565b5f6101bd82610161565b6101c7818561016b565b93506101d781856020860161017b565b6101e0816101a3565b840191505092915050565b5f6020820190508181035f83015261020381846101b3565b905092915050565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b61025a826101a3565b810181811067ffffffffffffffff8211171561027957610278610224565b5b80604052505050565b5f61028b61020b565b90506102978282610251565b919050565b5f67ffffffffffffffff8211156102b6576102b5610224565b5b6102bf826101a3565b9050602081019050919050565b828183375f83830152505050565b5f6102ec6102e78461029c565b610282565b90508281526020810184848401111561030857610307610220565b5b6103138482856102cc565b509392505050565b5f82601f83011261032f5761032e61021c565b5b813561033f8482602086016102da565b91505092915050565b5f6020828403121561035d5761035c610214565b5b5f82013567ffffffffffffffff81111561037a57610379610218565b5b6103868482850161031b565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f60028204905060018216806103d357607f821691505b6020821081036103e6576103e561038f565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026104487fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261040d565b610452868361040d565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f61049661049161048c8461046a565b610473565b61046a565b9050919050565b5f819050919050565b6104af8361047c565b6104c36104bb8261049d565b848454610419565b825550505050565b5f90565b6104d76104cb565b6104e28184846104a6565b505050565b5b81811015610505576104fa5f826104cf565b6001810190506104e8565b5050565b601f82111561054a5761051b816103ec565b610524846103fe565b81016020851015610533578190505b61054761053f856103fe565b8301826104e7565b50505b505050565b5f82821c905092915050565b5f61056a5f198460080261054f565b1980831691505092915050565b5f610582838361055b565b9150826002028217905092915050565b61059b82610161565b67ffffffffffffffff8111156105b4576105b3610224565b5b6105be82546103bc565b6105c9828285610509565b5f60209050601f8311600181146105fa575f84156105e8578287015190505b6105f28582610577565b865550610659565b601f198416610608866103ec565b5f5b8281101561062f5784890151825560018201915060208501945060208101905061060a565b8683101561064c5784890151610648601f89168261055b565b8355505b6001600288020188555050505b50505050505056fea2646970667358221220a1ad87bb62febdb78b44ef5c4bec0f64d8f3b47288a9add911181a32b2231d7f64736f6c63430008160033'
    const factory = new ethers.ContractFactory(abi, byteCode, wallet)
    const contractInstance = await factory.deploy()
    console.log('HelloWorld.sol is deployed at ', contractInstance.target)
    const tx = contractInstance.deploymentTransaction()  //This is only available if this instance was returned from a ContractFactory.
    console.log('transaction details used to deploy contract')
    console.log(tx)
    const deployedCode = await contractInstance.getDeployedCode()
    console.log('deployed code')
    console.log(deployedCode)
    console.log('HelloWorld.sol is deployed on hardhat')
}

deploy()

