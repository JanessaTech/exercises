const {ethers} = require('ethers')

function getWallet() {
    // 利用公共rpc节点连接以太坊网络
    // 可以在 https://chainlist.org 上找到
    //const SEPOLIA_URL = 'https://rpc.sepolia.org';
    //const providerSepolia = new ethers.JsonRpcProvider(SEPOLIA_URL)
    const provider = new ethers.JsonRpcProvider('http://127.0.0.1:8545/')
    const privateKey = '0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80'
    const wallet = new ethers.Wallet(privateKey, provider)
    return wallet
}

async function deploy() {
    const abi = [
        'function setMsg(string _mesg) public',
        'function getMsg() public view returns(string)'
    ]
    const wallet = getWallet()
    /**
     * input byteCode which you could get in 2 ways:
     * 1. In remix, click Bytecode button on compiling console
     * 2. In HelloWorld.json under artifact, get it in "object: field under "data"."bytecode" which looks like
     * "object": "608060405234801561000f575f80fd5b5... 
     */
    const byteCode ='60806040526040518060400160405280600f81526020017f64656661756c74206d65737361676500000000000000000000000000000000008152505f9081620000499190620002c1565b5034801562000056575f80fd5b50620003a5565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680620000d957607f821691505b602082108103620000ef57620000ee62000094565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f60088302620001537fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8262000116565b6200015f868362000116565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f620001a9620001a36200019d8462000177565b62000180565b62000177565b9050919050565b5f819050919050565b620001c48362000189565b620001dc620001d382620001b0565b84845462000122565b825550505050565b5f90565b620001f2620001e4565b620001ff818484620001b9565b505050565b5b8181101562000226576200021a5f82620001e8565b60018101905062000205565b5050565b601f82111562000275576200023f81620000f5565b6200024a8462000107565b810160208510156200025a578190505b62000272620002698562000107565b83018262000204565b50505b505050565b5f82821c905092915050565b5f620002975f19846008026200027a565b1980831691505092915050565b5f620002b1838362000286565b9150826002028217905092915050565b620002cc826200005d565b67ffffffffffffffff811115620002e857620002e762000067565b5b620002f48254620000c1565b620003018282856200022a565b5f60209050601f83116001811462000337575f841562000322578287015190505b6200032e8582620002a4565b8655506200039d565b601f1984166200034786620000f5565b5f5b82811015620003705784890151825560018201915060208501945060208101905062000349565b868310156200039057848901516200038c601f89168262000286565b8355505b6001600288020188555050505b505050505050565b6106ef80620003b35f395ff3fe608060405234801561000f575f80fd5b5060043610610034575f3560e01c8063b5fdeb2314610038578063c4784fd414610056575b5f80fd5b610040610072565b60405161004d91906101d6565b60405180910390f35b610070600480360381019061006b9190610333565b610101565b005b60605f8054610080906103a7565b80601f01602080910402602001604051908101604052809291908181526020018280546100ac906103a7565b80156100f75780601f106100ce576101008083540402835291602001916100f7565b820191905f5260205f20905b8154815290600101906020018083116100da57829003601f168201915b5050505050905090565b805f908161010f919061057d565b507f1817836ae3b5afe565ae5f9b40388de4ee15d41f925880d834a4d42e4eae5c67338260405161014192919061068b565b60405180910390a150565b5f81519050919050565b5f82825260208201905092915050565b5f5b83811015610183578082015181840152602081019050610168565b5f8484015250505050565b5f601f19601f8301169050919050565b5f6101a88261014c565b6101b28185610156565b93506101c2818560208601610166565b6101cb8161018e565b840191505092915050565b5f6020820190508181035f8301526101ee818461019e565b905092915050565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b6102458261018e565b810181811067ffffffffffffffff821117156102645761026361020f565b5b80604052505050565b5f6102766101f6565b9050610282828261023c565b919050565b5f67ffffffffffffffff8211156102a1576102a061020f565b5b6102aa8261018e565b9050602081019050919050565b828183375f83830152505050565b5f6102d76102d284610287565b61026d565b9050828152602081018484840111156102f3576102f261020b565b5b6102fe8482856102b7565b509392505050565b5f82601f83011261031a57610319610207565b5b813561032a8482602086016102c5565b91505092915050565b5f60208284031215610348576103476101ff565b5b5f82013567ffffffffffffffff81111561036557610364610203565b5b61037184828501610306565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f60028204905060018216806103be57607f821691505b6020821081036103d1576103d061037a565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026104337fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826103f8565b61043d86836103f8565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f61048161047c61047784610455565b61045e565b610455565b9050919050565b5f819050919050565b61049a83610467565b6104ae6104a682610488565b848454610404565b825550505050565b5f90565b6104c26104b6565b6104cd818484610491565b505050565b5b818110156104f0576104e55f826104ba565b6001810190506104d3565b5050565b601f82111561053557610506816103d7565b61050f846103e9565b8101602085101561051e578190505b61053261052a856103e9565b8301826104d2565b50505b505050565b5f82821c905092915050565b5f6105555f198460080261053a565b1980831691505092915050565b5f61056d8383610546565b9150826002028217905092915050565b6105868261014c565b67ffffffffffffffff81111561059f5761059e61020f565b5b6105a982546103a7565b6105b48282856104f4565b5f60209050601f8311600181146105e5575f84156105d3578287015190505b6105dd8582610562565b865550610644565b601f1984166105f3866103d7565b5f5b8281101561061a578489015182556001820191506020850194506020810190506105f5565b868310156106375784890151610633601f891682610546565b8355505b6001600288020188555050505b505050505050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6106758261064c565b9050919050565b6106858161066b565b82525050565b5f60408201905061069e5f83018561067c565b81810360208301526106b0818461019e565b9050939250505056fea2646970667358221220fe579dc27961d2b763fe01767c69814abb978aef35a718f9ab36e3e2dca644c164736f6c63430008160033'
    const factory = new ethers.ContractFactory(abi, byteCode, wallet)
    const contractInstance = await factory.deploy()
    console.log('HelloWorld.sol is deployed at ', contractInstance.target)
    const tx = contractInstance.deploymentTransaction()  //This is only available if this instance was returned from a ContractFactory.
    console.log('transaction details used to deploy contract')
    console.log(tx)
    const deployedCode = await contractInstance.getDeployedCode()
    console.log('deployed code')
    console.log(deployedCode)
    console.log('HelloWorld.sol is deployed on hardhat')
}

deploy()

